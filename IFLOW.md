# CVSC 中央体征管理平台

## 项目概述

CVSC（Central Vital Signs Collection）中央体征管理平台是一个基于 Streamlit 开发的医院体征数据管理和监控系统。该项目用于实时采集、存储、分析和展示患者的生命体征数据，如血压、体温、呼吸频率等，支持多厂商医疗设备的数据接入与标准化处理。

该系统通过 SQL Server 数据库存储体征数据，并提供 Web 界面供医护人员查看患者体征趋势、管理医疗设备、配置字段映射关系等功能。项目采用了标准的三层架构：前端展示（Streamlit）、业务逻辑层（Python）和数据持久化层（SQL Server）。

项目的主要功能模块包括：
- 实时监控看板：展示全院体征数据采集情况
- 患者数据分析：查询和分析特定患者的体征数据
- 设备管理：管理医疗设备信息
- 字段映射：配置不同厂商设备与标准体征字段的映射关系
- 系统日志：展示系统运行状态

## 技术栈

- **编程语言**: Python
- **前端框架**: Streamlit（用于 Web 界面）
- **数据库**: SQL Server
- **数据库连接**: SQLAlchemy + pyodbc
- **数据处理**: pandas, numpy
- **可视化**: plotly
- **日志记录**: logging

## 文件结构

```
D:\Work\2025\体征管理平台\cvsc-streamlit\
├───app.py                    # 主应用程序入口
├───.vscode\settings.json     # VSCode 配置
└───doc\
    ├───中央体征采集平台（CVSC）表结构设计.pdf  # 数据库设计文档
    └───cvsc_ddl.txt          # 数据库表定义（SQL）
```

## 数据库设计

系统使用 SQL Server 数据库，主要表结构包括：

### 核心业务表
- **cvsc_sign_main**: 体征数据主表，存储每次体征数据采集的基本信息
- **cvsc_sign_detail**: 体征数据详情表，存储具体的生命体征数据值
- **cvsc_standard_sign_config**: 标准体征字段表，定义标准化的体征字段
- **cvsc_device_model_config**: 设备型号配置表，存储体征采集设备型号信息
- **cvsc_device_field_rel**: 设备字段映射表，定义设备厂商原始字段与标准字段的映射关系

### 设备管理表
- **mr_monitor_info**: 监护设备信息表
- **mr_monitor_bind_records**: 监护设备绑定记录表

## 构建和运行

### 环境准备
1. 安装 Python 3.8+
2. 安装依赖包：
   ```bash
   pip install streamlit pandas numpy sqlalchemy pyodbc plotly
   ```

### 运行应用
```bash
streamlit run app.py
```

### 环境变量配置
系统使用以下环境变量配置数据库连接：
- `DB_USER`: 数据库用户名（默认：wnopuser）
- `DB_PASSWORD`: 数据库密码（默认：hayymoni2018）
- `DB_HOST`: 数据库主机地址（默认：10.52.197.73）
- `DB_NAME`: 数据库名称（默认：UNIONDEV）

## 主要功能

### 1. 实时监控看板
- 展示全院体征数据采集量、在线设备数、监护患者数等关键指标
- 支持按患者ID查询体征数据
- 提供体征数据趋势图表展示

### 2. 患者数据分析
- 显示最近活跃的患者列表
- 提供患者体征数据对比分析功能

### 3. 设备管理
- 管理医疗设备资产信息
- 支持设备信息的查看、编辑和新增

### 4. 字段映射
- 配置不同厂商设备原始字段与标准体征字段的对应关系
- 支持数据转换公式配置

### 5. 系统日志
- 展示系统运行状态
- 提供采集服务日志统计

## 代码架构

### 数据库连接管理
- 使用 `@st.cache_resource` 装饰器缓存数据库引擎连接
- 通过 `get_db_engine()` 函数创建和测试数据库连接
- 使用连接池管理数据库连接，提高性能

### 查询与更新函数
- `run_query()`: 执行查询操作，返回 DataFrame
- `run_update()`: 执行更新/插入/删除操作，包含事务处理
- 使用 `@st.cache_data` 装饰器缓存查询结果，提高响应速度

### 数据处理
- 使用 pandas 进行数据处理和分析
- 支持体征数据的单位转换和公式计算
- 使用 `@lru_cache` 装饰器优化函数性能

## 开发约定

- 所有数据库查询使用参数化查询防止 SQL 注入
- 使用 logging 模块记录系统日志
- 代码中使用中文注释，便于理解和维护
- 数据库连接使用连接池管理，提高性能和稳定性
- 使用 Streamlit 的缓存机制优化应用性能
- 遵循 Python PEP 8 代码规范